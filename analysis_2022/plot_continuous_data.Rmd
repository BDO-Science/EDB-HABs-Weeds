---
title: "plot_continuous_data"
author: "Catarina Pien"
date: '2022-10-08'
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(lubridate) #today()
library(readr)
library(here)
library(Polychrome)
library(viridis)
library(deltamapr)

data_root = "analysis_2022/"
```

Read data
```{r}
wq_data <- readRDS(here(data_root,"data_clean", "continuous_wq_2015_2022.rds"))
wq_sf <- st_as_sf(wq_data, coords = c("Longitude", "Latitude"), remove = FALSE)
st_crs(wq_sf) <- 4326
delta_4326 <- st_transform(WW_Delta, crs = st_crs(wq_sf))
stations <- wq_sf %>% 
  dplyr::select(Site, Analyte, Latitude, Longitude) %>%
  unique()
```

# Plots
## Map of stations
```{r}
ggplot() + 
  geom_sf(data = delta_4326, fill = "lightblue", color = "lightblue") +
  geom_sf(data = stations)+
  geom_text(data = stations, aes(x = Longitude, y = Latitude, label = Site), size = 3, vjust = 1.5, hjust = 1)+
  scale_x_continuous(limits = c(-121.8, -121.2)) +
  scale_y_continuous( limits = c(37.8, 38.3))+
  annotation_north_arrow(location = "tr", which_north = "true",
                             pad_x = unit(.1, "in"), pad_y = unit(0.2, "in"),
                             style = north_arrow_fancy_orienteering) +
      annotation_scale(location = "bl", bar_cols = c("black", "white", "black", "white")) +
  #viridis::scale_color_viridis(option = "plasma") +
  theme_bw()
```

## 2022 only
```{r}
wq_2022 <- filter(wq_data, Year == 2022)
pal36 <- palette36.colors(36)
pal36 <- as.vector(t(pal36))

(plot_cont_2022 <- ggplot(wq_2022) + 
  geom_line(aes(x = Date, y = Daily.Mean, color = Site)) + 
  geom_point(aes(x = Date, y = Daily.Mean, color = Site), size = 0.6) + 
  facet_wrap(~Analyte, scales = "free_y", nrow = 7, strip.position = "left", labeller = as_labeller(c(Chl.a = "Chl a\n(mg/L)",DO.Conc = "DO \n(mg/L)", Flow = "Flow (cfs)", pH = "pH",SpCond="SpCnd \n(mS/cm)", Turb="Turbidity \n(FNU)", Temp="Water Temp \n(°C)")))+
    theme(strip.background = element_rect(fill="White", color = "White"),
          strip.placement = "outside", axis.title.y = element_blank(), legend.position = "top")+
  scale_color_viridis(option = "turbo", discrete = TRUE) +
  scale_x_date(breaks = "month", date_labels = "%b", expand = c(0,0)) + 
  labs(y = "Daily Mean Value") +
  theme_bw())
```

## Across year, by parameter
```{r}
(plot_cont_allyears <- ggplot(wq_data) + 
   geom_line(aes(x = Date, y = Daily.Mean, color = Site)) + 
  facet_wrap(~Analyte, scales = "free_y", nrow = 7, strip.position = "left", labeller = as_labeller(c(Chl.a = "Chl a\n(mg/L)",DO.Conc = "DO \n(mg/L)", Flow = "Flow (cfs)", pH = "pH",SpCond="SpCnd \n(mS/cm)", Turb="Turbidity \n(FNU)", Temp="Water Temp \n(°C)")))+
    theme(strip.background = element_rect(fill="White", color = "White"),
          strip.placement = "outside", axis.title.y = element_blank(), legend.position = "top")+
  scale_color_viridis(option = "turbo", discrete = TRUE) +
  scale_x_date(breaks = "3 months", date_labels = "%b", expand = c(0,0))+ 
  labs(y = "Daily Mean Value") + 
  theme_bw())
```

```{r}

```

Export Figures
```{r}
png(filename = here("analysis_2022", "figures", "plot_cont_2022.png"), width = 10, height = 7, units = "in", pointsize = 12, family = "sans", res = 300)
plot_cont_2022
dev.off()


png(filename = here("analysis_2022", "figures", "plot_cont_2015_2022.png"), width = 10, height = 7, units = "in", pointsize = 12, family = "sans", res = 300)
plot_cont_allyears
dev.off()
```

# Tables
2-5 Station Code - Operator - USGS Station ID - Station Name - Latitude - Longitude - Sensors
```{r}

```

