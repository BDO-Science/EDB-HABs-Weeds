---
title: "map_stations"
author: "Catarina Pien"
date: '2022-10-24'
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(lubridate) #today()
library(readr)
library(here)
library(Polychrome)
library(viridis)
library(deltamapr)
library(sf)
library(ggspatial)

data_root = "analysis_2022/"
```

```{r}
sta <- read_excel(here(data_root, "data_clean", "continuous_stations.xlsx")) %>%
  filter(Type == "WQ") %>%
  dplyr::select(-Type) %>%
  rename(Site = StationCode) %>%
  mutate(Type = "Continuous WQ")

sta_sf <- st_as_sf(sta, coords = c("Longitude", "Latitude"), remove = FALSE)
st_crs(sta_sf) <- 4326

wq_data <- readRDS(here(data_root,"data_clean", "continuous_wq_2015_2022.rds")) %>%
  mutate(fYear = factor(Year))

# For map:
wq_sf <- st_as_sf(wq_data, coords = c("Longitude", "Latitude"), remove = FALSE)
st_crs(wq_sf) <- 4326
delta_4326 <- st_transform(WW_Delta, crs = st_crs(sta_sf))
stations <- wq_sf %>% 
  dplyr::select(Site, Analyte, Latitude, Longitude) %>%
  unique()

#Regions
load("../data/Regions.RData")
```

## Map of stations
```{r}
(wq_map <- ggplot() + 
  geom_sf(data = delta_4326, fill = "lightblue", color = "lightblue") +
  geom_sf(data = sta_sf)+
  geom_sf(data = reg3, aes(fill = Stratum), inherit.aes = FALSE, alpha = 0.1)+
  geom_text(data = stations, aes(x = Longitude, y = Latitude, label = Site), size = 3, vjust = 1, hjust = 1)+
  scale_x_continuous(limits = c(-121.8, -121.4)) +
  scale_y_continuous( limits = c(37.9, 38.15))+
  annotation_north_arrow(location = "tr", which_north = "true",
                             pad_x = unit(.1, "in"), pad_y = unit(0.2, "in"),
                             style = north_arrow_fancy_orienteering) +
      annotation_scale(location = "bl", bar_cols = c("black", "white", "black", "white")) +
  theme_bw())
```


## Write

```{r}
png(filename = here("analysis_2022", "figures", "wq_map.png"), width = 8, height = 8, units = "in", pointsize = 12, family = "sans", res = 300)
wq_map
dev.off()
```


# Tables
2-5 Station Code - Operator - USGS Station ID - Station Name - Latitude - Longitude - Sensors
```{r}

```
